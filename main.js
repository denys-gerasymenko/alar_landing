!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Compass=t():e.Compass=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>Le});const s="compass-input-wrapper",i="compass-text-line",n="compass-single-object",o="compass-multi-object",a="compass-button",r="compass-date-of-birth",h="compass-date",d="compass-email",p="compass-phone",c="compass-float",l="compass-integer",u="compass-post-image",m="compass-smile",b="compass-time",g="compass-time-duration",v="compass-input",_="compass-audio",f="compass-video",x="alar-radio-button",w="checkbox-component",C="alar-radio-group",E="alar-checkbox-group",y="alar-dropdown";class A extends HTMLElement{events=[];children="";props={};constructor(){super()}connectedCallback(){this.render(),this._setListeners()}addEvent(e,{target:t,handler:s}){this.#e({event:e,target:t,handler:s})}on(e,t){this.#e({event:e,target:this,handler:t})}#e({target:e,event:t,handler:s}){"string"==typeof s&&(s=this[s]),this.events.push({target:e,event:t,handler:s}),e.addEventListener(t,s)}_setListeners(){this.events.forEach((({event:e,method:t})=>{"string"==typeof t&&(t=this[t]),this.addEventListener(e,t)}))}getParsedAttribute(e){return JSON.parse(this.getAttribute(e))}setStringifiedAttribute(e,t){this.setAttribute(e,JSON.stringify(t))}disconnectedCallback(){this.events.forEach((({event:e,method:t})=>{"string"==typeof t&&(t=this[t]),this.removeEventListener(e,t)}))}trigger(e,t={},s={}){const i=new CustomEvent(e,{bubbles:!0,detail:t,...s});this.dispatchEvent(i)}focus(){this.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')?.focus()}render(){}}class L extends A{get value(){return this.querySelector("input").value}}window.customElements.define("input-component",class extends L{render(){const e=document.createElement("input");this.append(e)}});class S extends L{type="";#t=document.createElement("input");#s=document.createElement("label");get label(){return this.#s.innerHTML}get input(){return this.#t}render(){this.classList.add(`alar-${this.type}`);const{text:e="",value:t="",isCustom:s=!1,name:i=""}=this.props,n=this.props.id||t;this.#t.id=`${this.type}_${n}`,this.#t.type=this.type,this.#t.setAttribute("role",this.type),this.#t.setAttribute("aria-checked",!1),this.#t.name=`${i}_${this.type}`,this.#t.value=t,this.#t.classList.add("alar-base-check-input"),this.#s.classList.add("alar-base-check-label"),s&&(this.#t.style="appearance: none; -webkit-appearance: none;",this.#t.classList.add("alar-base-check__custom-input"),this.#s.classList.add("alar-base-check__custom-label"),this.classList.add("alar-base-check__custom")),this.#s.setAttribute("for",`${this.type}_${n}`),this.#s.innerHTML=e,this.append(this.#t,this.#s)}focus(){this.#t.focus()}}window.customElements.define(x,class extends S{type="radio"});const k=Object.freeze({ARIA_CHECKED:"aria-checked"});class M extends A{#i;#n;constructor(){super(),this.on("input",this.onChange)}set options(e){this.setAttribute("options",JSON.stringify(e))}get options(){return JSON.parse(this.getAttribute("options"))}get hasValue(){}setRadio(){this.#i="radiogroup",this.#n=x}setCheckbox(){this.#i="group",this.#n=w}onChange=e=>{this.selected=e.target.closest(this.#n)};render(){this.setAttribute("role",this.#i),this.options.forEach(((e,t)=>{const s=document.createElement(this.#n);for(let t in e)s.props[t]=e[t];this.append(s)}))}}window.customElements.define(C,class extends M{#o=null;constructor(){super(),this.setRadio(),this.on("input",this.#a)}get hasValue(){return!!this.#o}get selected(){return this.#o}set selected(e){this.#o=e}#a=()=>{const e=this.querySelector(`[${k.ARIA_CHECKED}='true']`);e&&e.setAttribute(k.ARIA_CHECKED,!1),this.selected.setAttribute(k.ARIA_CHECKED,!0)}}),window.customElements.define(w,class extends S{constructor(){super(),this.type="checkbox",this.on("input",this.#r)}#r=()=>{this.input.setAttribute(k.ARIA_CHECKED,this.input.checked)}});const D=Object.freeze({ENTER:"Enter",SPACE:"Space",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",ESCAPE:"Escape",BACKSPACE:"Backspace",HOME:"Home",END:"End",CLEAR:"Clear"});var I=0,T=1,O=2,R=3,H=4,P=5,W=6,$=7,B=8,N=10;window.customElements.define(y,class extends L{static get observedAttributes(){return["options","selected"]}constructor(){super(),this._activeIndex=0,this._open=!1,this.comboEl=document.createElement("div"),this.comboEl.setAttribute("role","combobox"),this.comboEl.setAttribute("tabindex",0),this.comboEl.setAttribute("aria-haspopup","listbox"),this.comboEl.setAttribute("aria-expanded",!1),this.comboEl.setAttribute("aria-controls","listbox1"),this.comboEl.classList.add("combo-input"),this.listboxEl=document.createElement("div"),this.listboxEl.setAttribute("role","listbox"),this.listboxEl.setAttribute("id","listbox1"),this.listboxEl.classList.add("combo-menu")}render(){this.classList.add("dropdown");const{id:e="combo",options:t=[],activeIndex:s,directionUp:i}=this.props;this.options=t,this.activeIndex=s,this.idBase=e,this._init(),this.append(this.comboEl),this._registerComboEvents(),i&&(this.listboxEl.style.bottom=`${this.comboEl.offsetHeight}px`),this.append(this.listboxEl)}get _options(){return JSON.parse(this.getAttribute("options"))}set options(e){this.setAttribute("options",JSON.stringify(e))}set activeIndex(e=0){this._activeIndex=e}attributeChangedCallback(e,t,s){switch(e){case"options":this._handleChangeOptions(JSON.parse(s));break;case"selected":this._handleOptionSelect(t,s)}}_init(){this.comboEl.innerHTML=this._getOptionText(),this._renderOptions(this._options)}_renderOptions(e){this.listboxEl.innerHTML="",e.map(((e,t)=>{const s=this.createOption(e,t);this.listboxEl.appendChild(s)}))}_handleOptionSelect(e,t){this.props?.on?.select?.(e,t)}_handleChangeOptions(e,t=0){this.activeIndex=t,this._renderOptions(e),this.comboEl.innerHTML=this._getOptionText()}_registerComboEvents(){this.on("click",this.onComboClick),this.on("blur",this.onComboBlur),this.on("keydown",this.onComboKeyDown)}onComboKeyDown=e=>{const{key:t}=e,s=this._options.length-1,i=function(e,t){const{key:s,altKey:i,ctrlKey:n,metaKey:o}=e,a=[D.ARROW_DOWN,D.ARROW_UP,D.ENTER," "];if(!t&&a.includes(s))return P;if(s===D.HOME)return O;if(s===D.END)return R;if(s===D.BACKSPACE||s===D.CLEAR||1===s.length&&" "!==s&&!i&&!n&&!o)return N;if(t){if(s===D.ARROW_UP&&i)return T;if(s===D.ARROW_DOWN&&!i)return H;if(s===D.ARROW_UP)return B;if(s===D.PAGE_UP)return $;if(s===D.PAGE_DOWN)return W;if(s===D.ESCAPE)return I;if(s===D.ENTER||" "===s)return T}}(e,this._open);switch(i){case R:case O:this.updateMenuState(!0);case H:case B:case $:case W:return e.preventDefault(),this.onOptionChange(function(e,t,s){switch(s){case O:return 0;case R:return t;case B:return Math.max(0,e-1);case H:return Math.min(t,e+1);case $:return Math.max(0,e-10);case W:return Math.min(t,e+10);default:return e}}(this._activeIndex,s,i));case T:e.preventDefault(),this.selectOption(this._activeIndex);case I:return e.preventDefault(),this.updateMenuState(!1);case N:return this.onComboType(t);case P:return e.preventDefault(),this.updateMenuState(!0)}};onComboBlur=()=>{this.ignoreBlur?this.ignoreBlur=!1:this._open&&(this.selectOption(this._activeIndex),this.updateMenuState(!1,!1))};onComboClick=()=>{this.updateMenuState(!this._open,!1)};_getOptionText(e=this._activeIndex){return"string"==typeof this._options[e]?this._options[e]:this._options[e].text}createOption(e,t){const s=document.createElement("div");return s.setAttribute("role","option"),s.id=`${this.idBase}-${t}`,s.classList.add("combo-option"),t===this._activeIndex&&(s.classList.add("option-current"),s.setAttribute("aria-selected",!0)),s.innerText=this._getOptionText(t),s.setAttribute("value",e.value),s.addEventListener("click",(e=>{e.stopPropagation(),this.onOptionClick(t)})),s.addEventListener("mousedown",this.onOptionMouseDown),s}onOptionMouseDown=()=>{this.ignoreBlur=!0};onOptionClick(e){this.onOptionChange(e),this.selectOption(e),this.updateMenuState(!1)}onOptionChange(e){this._activeIndex=e,this.comboEl.setAttribute("aria-activedescendant",`${this.idBase}-${e}`);const t=this.querySelectorAll("[role=option]");[...t].forEach((e=>{e.classList.remove("option-current")})),t[e].classList.add("option-current")}selectOption(e){this._activeIndex=e,this.comboEl.innerHTML=this._getOptionText(e),this.setAttribute("selected",this._options[e]?.value||e);const t=this.querySelectorAll("[role=option]");[...t].forEach((e=>{e.setAttribute("aria-selected","false")})),t[e].setAttribute("aria-selected","true")}updateMenuState(e,t=!0){if(this._open===e)return;this._open=e,this.comboEl.setAttribute("aria-expanded",`${e}`),e?this.classList.add("open"):this.classList.remove("open");const s=e?`${this.idBase}-${this._activeIndex}`:"";this.comboEl.setAttribute("aria-activedescendant",s),t&&this.comboEl.focus(),e?this.props?.on?.open?.():this.props?.on?.close?.()}}),window.customElements.define(E,class extends M{#o=[];constructor(){super(),this.setCheckbox()}get hasValue(){return!!this.#o.length}set selected(e){const{checked:t}=e.input;this.#o=t?Array.from(new Set([...this.#o,e])):this.#o.filter((({input:t})=>t.value!==e.input.value))}get selected(){return this.#o}});const q="COMPASS_SUBMIT",U="COMPASS_FINISH";class j{static instance=null;#h={};constructor(e){if(j.instance)return j.instance;j.instance=this,this.#h=e}set store(e){this.#h=e}get store(){return{...this.#h}}}const Y={views:()=>j.instance.store?.views||{},loading(){return this.views().loading||document.createElement("compass-loading")},formButton(){const e=this.views().formButton;if(e)return e;{const e=document.createElement("button");return e.classList.add("compass-form-submit"),e.textContent="click",e}}},F={inputs:()=>j.instance.store?.inputs||{},postImage(){const{url:e="",renderImages:t=(()=>{})}=this.inputs().postImage||{};return{url:e,renderImages:t}}};class V extends A{constructor(){super()}}class z extends V{inputWrapper=document.createElement(v);placeholder="";errorWrapper=document.createElement("div");errorClass="compass-input-error";constructor(){super(),this.form=document.createElement("form"),this.form.classList.add("compass-form"),this.button=Y.formButton(),this.button.type="submit",this.button.disabled=!0,this.errorWrapper.classList.add("compass-error-wrapper"),this.on("input",this.onInput)}cleanError(){this.errorWrapper.textContent="",this.classList.remove(this.errorClass)}set error(e){this.classList.add(this.errorClass),this.errorWrapper.textContent=e}get value(){return this.inputWrapper.value.trim()}set value(e){this.inputWrapper.value=e}focus(){this?.inputWrapper.focus()}onInput(){this.button.disabled=!this.inputWrapper.hasValue,this.cleanError()}handleSubmit=()=>{};send({value:e,text:t}){this.trigger(q,{value:e,text:t})}render(){this.inputWrapper.placeholder=this.placeholder,this.addEvent("submit",{target:this.form,handler:this.handleSubmit}),this.form.append(this.inputWrapper),this.form.append(this.button),this.form.append(this.errorWrapper),this.append(this.form)}}window.customElements.define(n,class extends z{constructor(){super(),this.inputWrapper=document.createElement(C),this.inputWrapper.classList.add("compass-radio-group")}render(){this.inputWrapper.options=this.props.options,super.render()}handleSubmit=e=>{e.preventDefault(),this.send({value:this.inputWrapper.selected.value,text:this.inputWrapper.selected.label})}}),window.customElements.define("compass-header",class extends V{}),window.customElements.define("compass-chat",class extends V{constructor(){super(),this.classList.add("compass-chat")}}),window.customElements.define(s,class extends V{constructor(){super(),this.classList.add("compass-input-wrapper")}}),window.customElements.define("compass-loading",class extends V{render(){this.classList.add("compass-loading"),this.innerHTML='\n      <div class="compass-loading__text">loading</div>\n    '}}),window.customElements.define(i,class extends z{handleSubmit=e=>{e.preventDefault(),this.send({value:this.inputWrapper.value,text:this.inputWrapper.value})}}),window.customElements.define("compass-message",class extends V{#d;set message(e){this.#d=e}render(){this.classList.add("compass-message");const e=document.createElement("div");this.#d instanceof HTMLElement?e.append(this.#d):e.innerHTML=this.#d,e.classList.add("compass-message__text"),this.append(e)}}),window.customElements.define("compass-component",class extends V{render(){this.innerHTML='\n      <compass-header></compass-header>\n      <div class="compass-chat-wrapper">\n        <compass-chat></compass-chat>\n      </div>\n      <compass-input-wrapper></compass-input-wrapper>\n    '}}),window.customElements.define(a,class extends V{render(){this.addEventListener("click",this._handleClick);const e=document.createElement("button");e.textContent=this.props.textContent,this.append(e)}_handleClick=()=>{this.trigger(U)}}),window.customElements.define(o,class extends z{constructor(){super(),this.inputWrapper=document.createElement(E),this.inputWrapper.classList.add("compass-radio-group"),this.inputWrapper.on("click",this.#p)}props;_minAnswersCount=1;set minAnswersCount(e){this._minAnswersCount=e}get minAnswersCount(){return this._minAnswersCount}_maxAnswersCount=1;set maxAnswersCount(e){this._maxAnswersCount=e}get maxAnswersCount(){return this._maxAnswersCount}_selectedAnswersCount=0;set selectedAnswersCount(e){this._selectedAnswersCount=e}get selectedAnswersCount(){return this._selectedAnswersCount}#p=e=>{const t=e.target.checked;if("boolean"!=typeof t)return;const s=this.selectedAnswersCount+(t?1:-1);s>this.maxAnswersCount?e.preventDefault():this.selectedAnswersCount=s};handleSubmit=e=>{if(e.preventDefault(),e.stopPropagation(),this.selectedAnswersCount<this.minAnswersCount)return;const t=this.inputWrapper.selected,s=t.map((e=>e.value)).join(","),i=t.map((e=>e.closest(w).label)).join(",");this.send({value:s,text:i})};render(){const{options:e,optionsData:t}=this.props;this.minAnswersCount=t.min,this.maxAnswersCount=t.max,this.inputWrapper.options=e,super.render()}});class K extends V{events=[{event:"submit",method:"_handleSubmit"}];#c;#l;#u;#m;#b;#g;#v=["January","February","March","April","May","June","July","August","September","October","November","December"];#_;#f;#x;#w;#C;#E;constructor(e){super(e),this.#m=e.yearsRightLimiter??0,this.#b=e.yearsLeftLimiter??120,this.#g=new Date,this.#w=this.#g.getFullYear()-this.#b,this.#C=this.#g.getFullYear()-this.#m,this.#_=this.#C,this.#f=this.#g.getMonth(),this.#x=this.#g.getDate(),this.#E=e.wrongDateText,this.#y(),this.#A(),this.#L()}#y(){this.#c=document.createElement(y);const e=[];for(let t=this.#C;t>=this.#w;--t)e.push({value:t,text:t});this.#c.props={options:e,activeIndex:0,on:{open:()=>{[this.#u,this.#l].forEach((e=>{e.updateMenuState(!1,!1)}))},select:(e,t)=>{this.#_=Number(t),this.#u.options=this.#S()}}}}#A(){this.#l=document.createElement(y),this.#f=this.#g.getMonth();const e=[];for(let t=0;t<this.#v.length;++t)e.push({value:t,text:this.#v[t]});this.#l.props={options:e,activeIndex:this.#f,on:{open:()=>{[this.#u,this.#c].forEach((e=>{e.updateMenuState(!1,!1)}))},select:(e,t)=>{this.#f=Number(t),this.#u.options=this.#S(),this.#x=1}}}}#L(){this.#u=document.createElement(y),this.#u.props={options:this.#S(),activeIndex:this.#x-1,on:{open:()=>{[this.#l,this.#c].forEach((e=>{e.updateMenuState(!1,!1)}))},select:(e,t)=>{this.#x=Number(t)}}}}#S(){const e=[],t=new Date(this.#_,this.#f+1,0).getDate();for(let s=1;s<=t;++s)e.push({value:s,text:s});return e}#k(){const e=new Date(this.#_,this.#f,this.#x),t=new Date(this.#w,this.#g.getMonth(),this.#g.getDate()).getTime()>e.getTime(),s=new Date(this.#C,this.#g.getMonth(),this.#g.getDate()).getTime()<e.getTime();return!(t||s)}_handleSubmit=e=>{if(e.preventDefault(),!this.#k())return void console.log(this.#E);const t=`${`${this.#f+1}`.padStart(2,"0")}/${`${this.#x}`.padStart(2,"0")}/${this.#_}`;this.trigger(q,{value:t,text:t})};render(){this.innerHTML='\n        <form>\n            <div class="inputs"></div>\n            <button type="submit">Click</button>\n        </form>\n    ',this.querySelector(".inputs").append(this.#l,this.#u,this.#c)}}window.customElements.define(r,class extends K{constructor(){super({yearsRightLimiter:16,yearsLeftLimiter:120,wrongDateText:"YOUR AGE MUST BE LESS THAN 16 AND MORE THAN 120"})}}),window.customElements.define(h,class extends K{constructor(){super({yearsRightLimiter:0,yearsLeftLimiter:120,wrongDateText:"YOUR AGE DATE MUST BE LESS THAN TOMORROW AND MORE THAN 120 YEARS FROM PAST"})}}),window.customElements.define(d,class extends z{constructor(){super(),this.placeholder="enter email",this.inputWrapper.type="email"}get#M(){return/^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i.test(this.value)}render(){super.render(),this.submitMethod=this.props.blank_enabled?this.#D:this.#I,this.button.disabled=!this.props.blank_enabled}onInput(){super.onInput(),this.button.disabled=!this.value&&!this.props.blank_enabled}#D(){!this.value&&this.props.blank_enabled&&this.send(),this.#T()}#I(){this.#T()}#T(){this.#M?this.send():this.error=this.props.errorMessage||"wrong email"}send(){super.send({text:this.inputWrapper.value,value:this.inputWrapper.value})}handleSubmit=e=>{e.preventDefault(),this.submitMethod(e),!this.value&&this.props.blank_enabled&&this.send(),this.#M?this.send():this.error=this.props.errorMessage||"wrong email"}}),window.customElements.define(p,class extends z{#O=10;constructor(){super(),this.placeholder="enter phone number"}get#R(){return new RegExp(`^[0-9]{${this.#O}}$`).test(this.value)}onInput(){super.onInput(),this.value.length>this.#O&&(this.value=this.value.slice(0,this.#O)),this.value.search(/\D/g)>=0&&(this.value=this.value.replace(/[\D]/g,"")),this.button.disabled=!this.inputWrapper.hasValue}handleSubmit=e=>{e.preventDefault(),this.#R?this.send({text:this.inputWrapper.value,value:this.inputWrapper.value}):this.error="invalid phone number"}});class J extends z{errorMessage;regex;isValid(){return!!this.regex.test(this.value)&&this.checkMin(this.props.min)&&this.checkMax(this.props.max)}checkMin(e){return!!isNaN(e)||this.value>=e}checkMax(e){return!!isNaN(e)||this.value<=e}handleSubmit=e=>{e.preventDefault(),this.isValid()?this.send({text:this.inputWrapper.value,value:this.inputWrapper.value}):this.error=this.errorMessage}}window.customElements.define(c,class extends J{constructor(){super(),this.placeholder="enter float",this.regex=new RegExp(/^[-+]?\d+(\.\d+)?$/),this.errorMessage="invalid float"}}),window.customElements.define(l,class extends J{constructor(){super(),this.placeholder="enter integer",this.regex=new RegExp(/^[-+]?\d*?$/),this.errorMessage="invalid integer"}});const G=Object.freeze({smiles:{path:"http://127.0.0.1:5000/static/img/therapeutics/face_picker/",items:[{src:"tons.svg",text:"90050019"},{src:"a_lot.svg",text:"8ed8a856"},{src:"so-so.svg",text:"8ab37c0d"},{src:"nan.svg",text:"e760157a"}]}});window.customElements.define(m,class extends z{#H;constructor(){super(),this.#P(),this.inputWrapper=document.createElement(C),this.inputWrapper.options=this.#H,this.inputWrapper.classList.add("compass-radio-group")}#P(){const{path:e}=G.smiles;this.#H=G.smiles.items.map(((t,s)=>({value:s,text:`\n          <img src="${e}${t.src}" />\n          <span>${t.text}</span>\n        `,isCustom:!0})))}handleSubmit=e=>{e.preventDefault(),this.send({value:this.inputWrapper.selected.value,text:this.inputWrapper.selected.label})}});const Z=new class{async post(e,t,s={},i={}){return(await fetch(e,{method:"POST",body:JSON.stringify(t),credentials:"include",...s,headers:{"Content-Type":"application/json",...i}})).json()}async get(e,t={},s={}){return(await fetch(e,{method:"GET",...t,headers:{...s}})).json()}};window.customElements.define(u,class extends V{#W;constructor(){super(),this.firstButton=document.createElement("button"),this.secondButton=document.createElement("button"),this.firstButton.textContent="Upload Photo or Pick from Gallery",this.secondButton.textContent="Pick One for Me",this.firstButton.addEventListener("click",this.onUploadClick)}onUploadClick=async e=>{e.preventDefault(),F.postImage().renderImages?.(this.#W,this.onChooseImage)};onChooseImage=e=>{this.trigger(q,{value:`${e.id},${e.src}`,text:`\n        <img src=${e.src} />\n      `})};async render(){this.#W=await Z.get(F.postImage().url),this.append(this.firstButton,this.secondButton)}});const Q="AM",X="PM";class ee extends A{events=[{event:"submit",method:"_handleSubmit"}];#$;#B;#N;constructor(e={}){super(e),this.options=e,this.is12hTimeFormat=(new Date).toLocaleTimeString([],{timeStyle:"short"}).includes("M")&&(e.canBe12hFormat??!0),this.defaultTime=e.defaultTime,this.minHours=e.minHours??0,this.maxHours=e.maxHours??23,this.timeInterval=e.timeInterval??15,this.selectedTime=this.getTimeParts(this.defaultTime),this.hoursList=this.getHoursList(),this.minutesList=this.getMinutesList(),this.periodsList=this.getPeriodsList()}#q(){this.#$=document.createElement(y),this.#$.props={options:this.hoursList,activeIndex:this.selectedHoursIndex,on:{select:(e,t)=>{this.selectedHours!==t&&(this.selectedHours=t)},open:()=>{[this.#B,this.#N].forEach((e=>{e&&e.updateMenuState(!1,!1)}))}}},this.querySelector(".inputs").append(this.#$)}#U(){this.#B=document.createElement(y),this.#B.props={options:this.minutesList,activeIndex:this.selectedMinutesIndex,on:{select:(e,t)=>{this.selectedMinutes!==t&&(this.selectedMinutes=t)},open:()=>{[this.#$,this.#N].forEach((e=>{e&&e.updateMenuState(!1,!1)}))}}},this.querySelector(".inputs").append(this.#B)}#j(){this.#N=document.createElement(y),this.#N.props={options:this.periodsList,activeIndex:this.selectedPeriodIndex,on:{select:(e,t)=>{if(this.selectedPeriod===t)return;this.selectedPeriod=t,this.hoursList=this.getHoursList(),this.innerHTML="",this.render();const s=this.hoursList.map((e=>e.text)).indexOf(this.selectedTime.hours);-1!==s&&(this.selectedTime.hours=this.hoursList[s].text,this.selectedHours=this.hoursList[s].value,this.#$.activeIndex=s)},open:()=>{[this.#$,this.#B].forEach((e=>{e.updateMenuState(!1,!1)}))}}},this.querySelector(".inputs").append(this.#N)}get timeAs24Clock(){return this.twoDigitized(this.selectedHours+(this.selectedPeriod===X?12:0))+":"+this.selectedTime.minutes}get timeAs12Clock(){return this.selectedTime.hours+":"+this.selectedTime.minutes+this.selectedTime.period??""}get selectedHours(){return Number(this.selectedTime.hours)}set selectedHours(e){this.selectedTime.hours=this.twoDigitized(e)}get selectedMinutes(){return Number(this.selectedTime.minutes)}set selectedMinutes(e){this.selectedTime.minutes=this.twoDigitized(e)}get selectedPeriod(){return this.selectedTime.period}set selectedPeriod(e){this.selectedTime.period=e}getSelectedIndex(e,t){const s=e.map((e=>e.text)).indexOf(this.selectedTime[t]);return s<0?0:s}get selectedHoursIndex(){return this.getSelectedIndex(this.hoursList,"hours")}get selectedMinutesIndex(){return this.getSelectedIndex(this.minutesList,"minutes")}get selectedPeriodIndex(){return this.getSelectedIndex(this.periodsList,"period")}getHoursList(){const e=[];let t=this.minHours,s=this.maxHours;if(this.is12hTimeFormat){const e=this.selectedPeriod??Q;e===Q&&s>=12?s=11:e===X&&(t<12?t=0:t-=12,s-=12)}for(let i=t;i<=s;++i)e.push({text:this.twoDigitized(i),value:i});return e}getMinutesList(){const e=[];for(let t=0;t<=59;t+=this.timeInterval)e.push({text:this.twoDigitized(t),value:t});return e}getPeriodsList(){const e=[];return this.minHours<12&&e.push({text:Q,value:Q}),this.maxHours>=12&&e.push({text:X,value:X}),e}getTimeParts(e){const t={};e||(e=`${this.minHours}:00`);const[s,i]=e.split(":");return t.hours=this.twoDigitized(s),t.minutes=i,this.is12hTimeFormat?(Number(s)<12?t.period=Q:(t.hours=this.twoDigitized(Number(s)-12),t.period=X),t):t}twoDigitized(e){return String(e).padStart(2,"0")}focus(){super.focus("[tabindex='0']")}_handleSubmit=e=>{e.preventDefault(),this.trigger(q,{value:this.timeAs24Clock,text:this.is12hTimeFormat?this.timeAs12Clock:this.timeAs24Clock})};render(){this.innerHTML='\n        <form>\n            <div class="inputs"></div>\n            <button type="submit">Click</button>\n        </form>\n    ',this.#q(),this.#U(),this.is12hTimeFormat&&this.#j()}}window.customElements.define(b,class extends ee{constructor(e){super({...e,canBe12hFormat:!0,maxHours:20,minHours:5,defaultTime:"5:45",timeInterval:15})}}),window.customElements.define(g,class extends ee{constructor(e){super({...e,canBe12hFormat:!1,maxHours:20,minHours:5,defaultTime:"14:30",timeInterval:15})}});class te extends V{#t;get hasValue(){return!!this.#t.value}set value(e){this.#t.value=e}get value(){return this.#t.value}get input(){return this.#t}set input(e){this.#t=e}set type(e){this.#t.type=e}set placeholder(e){this.#t.placeholder=e}}window.customElements.define(v,class extends te{constructor(){super(),this.input=document.createElement("input"),this.input.classList.add("compass-input")}render(){this.append(this.input)}}),window.customElements.define(_,class extends V{events=[{event:"submit",method:"_handleSubmit"}];props;constructor(e){super(e)}_handleSubmit=e=>{e.preventDefault(),this.props.onEnd("audio")};render(){this.innerHTML=`\n        <audio controls ${this.props.autoplay?"autoplay":""}>\n            <source src="${this.props.src}" type="audio/wav">\n        </audio> \n    `,this.querySelector("audio").onended=e=>this._handleSubmit(e)}}),window.customElements.define(f,class extends V{events=[{event:"submit",method:"_handleSubmit"}];props;constructor(e){super(e)}_handleSubmit=e=>{e.preventDefault(),this.props.onEnd("video")};render(){this.innerHTML=`\n        <video controls ${this.props.autoplay?"autoplay":""}>\n            <source src="${this.props.src}" type="video/mp4">\n            <source src="${this.props.src}" type="video/webm">\n        </video> \n    `,this.querySelector("video").onended=e=>this._handleSubmit(e)}});class se{constructor(e,t){this.model=e,this.view=t,this.view.bindUserSubmit(this.handleUserSubmit),this.model.bindAnnaAnswer(this.handleAppendAnnaMessage),this.model.bindUserAnswer(this.#Y),this.model.bindBeforeRequest(this.handleAppendLoading),this.model.bindAfterRequest(this.handleRemoveLoading),this.model.bindChangeInput(this.handleChangeInput),this.model.firstStart()}handleUserSubmit=e=>{this.model.onUserSubmit(e)};handleChangeInput=e=>{this.view.renderInput(e)};handleAppendAnnaMessage=(...e)=>{this.view.appendAnnaMessage(...e)};#Y=(...e)=>{this.view.appendUserMessage(...e)};handleAppendLoading=()=>{this.view.appendLoading()};handleRemoveLoading=()=>{this.view.removeLoading()}}const ie="text_line",ne="interim",oe="intro",ae="single_obj",re="single",he="end",de="multi",pe="multi_obj",ce="date_of_birth",le="date",ue="email",me="phone",be="float",ge="integer",ve="single_smileys_obj",_e="single_rating_obj",fe="time",xe="time_duration",we="audio",Ce="video",Ee="post_image";class ye{constructor(e){this.dialog=e.dialog,this.url=e.url,this.store=e.store}bindBeforeRequest=e=>this._onBeforeRequest=e;bindAfterRequest=e=>this._onAfterRequest=e;bindAnnaAnswer=e=>this._onAnnaAnswer=e;bindUserAnswer=e=>this._onUserAnswer=e;bindChangeInput=e=>this._onChangeInput=e;async start(e){await this.#F(e),this.#V(),this.#z()}async#F(e){return this._onBeforeRequest(),await this._request(e),this._onAfterRequest()}#z(){this._onAnnaAnswer(this.model.data.text,this.model.data.is_error),this._next()}#K(){this.model.history&&this.model.history.forEach((e=>{switch(this._onAnnaAnswer(e.data.text,e.data.is_error),e.data.type){case oe:case ne:case"post_preview":break;case Ee:const t=`<img src="${e.input.split(",")[1]}" />`;this._onUserAnswer(t);break;default:this._onUserAnswer(e.input)}}))}onUserSubmit=e=>{this.start({...this._requestData,client_input:e})};async firstStart(){await this.#F(this.dialog),this.#V(),this.#K(),this.#z()}_intro(){this.start({...this._requestData,client_input:oe})}get _requestData(){return{conversation_id:this.model.conversation_id,dialog_mode:this.model.dialog_mode,turn_number:this.model.turn_number}}get delay(){return 0}async _next(){switch(this.model.data.type){case oe:case ne:this._intro();break;case he:this._end();break;case ue:this._onEmail();break;case me:this._onPhone();break;case be:this._onFloat();break;case ge:this._onInteger();break;case ie:case"input":case"text":case"essay":this._onTextLine();break;case ae:case re:this._onSingle();break;case de:case pe:this._onMulti();break;case ce:this._onDateOfBirth();break;case ve:case _e:this.#J();break;case Ee:this.#G();break;case le:this._onDate();break;case fe:this._onTime();break;case xe:this._onTimeDuration();break;case we:this._onAudio();break;case Ce:this._onVideo()}}_end(){const e=document.createElement(a);e.props.textContent=this.model.data.button_text,this._onChangeInput(e)}_onVideo(){const e=document.createElement(f);e.props={src:this.model.data.media.media_url,autoplay:this.model.data.media.autoplay,onEnd:this.onUserSubmit},this._onAnnaAnswer(e)}_onAudio(){const e=document.createElement(_);e.props={src:this.model.data.media.media_url,autoplay:this.model.data.media.autoplay,onEnd:this.onUserSubmit},this._onAnnaAnswer(e)}_onTime(){const e=document.createElement(b);this._onChangeInput(e)}_onTimeDuration(){const e=document.createElement(g);this._onChangeInput(e)}_onEmail(){const e=document.createElement(d);e.props={blank_enabled:!!this.model.data.blank_enabled},this._onChangeInput(e)}#J(){const e=document.createElement(m);this._onChangeInput(e)}_onFloat(){const e=document.createElement(c);e.props={min:this.model.data.min,max:this.model.data.max},this._onChangeInput(e)}_onInteger(){const e=document.createElement(l);e.props={min:this.model.data.min,max:this.model.data.max},this._onChangeInput(e)}_onPhone(){const e=document.createElement(p);this._onChangeInput(e)}_onDateOfBirth(){const e=document.createElement(r);this._onChangeInput(e)}_onDate(){const e=document.createElement(h);this._onChangeInput(e)}#G(){const e=document.createElement(u);this._onChangeInput(e)}_onTextLine(){const e=document.createElement(i);this._onChangeInput(e)}_onMulti(){const e=document.createElement(o);e.props={options:this._mapOptions(),optionsData:{min:this.model.data.min,max:this.model.data.max}},this._onChangeInput(e)}_onSingle(){const e=document.createElement(n);e.props={options:this._mapOptions()},this._onChangeInput(e)}_mapOptions(){return this.model.data.options.map(((e,t)=>{const s={name:"compass",isCustom:!0};return"string"==typeof e?Object.assign(s,{value:e,text:e}):Object.assign(s,{value:e.id,text:e.answer}),s}))}_request=(e={})=>new Promise((async t=>{const s=await Z.post(this.url,e);setTimeout((()=>{this.model=s,t()}),this.delay)}));#V(){const e=new URLSearchParams(window.location.search).get("compass_input_type");if(e)switch(e){case ie:this.model.data={...this.model.data,type:ie};break;case ue:this.model.data={...this.model.data,type:ue};break;case me:this.model.data={...this.model.data,type:me};break;case"email_blank":this.model.data={...this.model.data,type:ue,blank_enabled:!0};break;case re:this.model.data={...this.model.data,type:re,options:["single 11111111","single 2222222"]};break;case ae:this.model.data={...this.model.data,type:ae,options:[{id:0,answer:"single obj 1111111"},{id:1,answer:"single obj 2222222"}]};break;case de:this.model.data={...this.model.data,type:de,max:4,min:1,options:["multi 1111","multi 2222","multi 3333"]};break;case pe:this.model.data={...this.model.data,type:de,max:2,min:1,options:[{id:0,answer:"multi obj 1111"},{id:1,answer:"multi obj 2222"},{id:2,answer:"multi obj 3333"}]};break;case ce:this.model.data={...this.model.data,type:ce};break;case le:this.model.data={...this.model.data,type:le};break;case fe:this.model.data={...this.model.data,type:fe,hours_min:0,hours_max:23,minutes_interval:5,default_time:"16:00"};break;case xe:this.model.data={...this.model.data,type:xe,hours_min:0,hours_max:23,minutes_interval:5,default_time:"16:00"};break;case we:this.model.data={...this.model.data,type:we,media:{media_url:"https://www.dropbox.com/s/c26fdsksh9q0nzg/Images%20-%20Lost%20European.wav?raw=1&t=.wav&_=2",autoplay:!1}};break;case Ce:this.model.data={...this.model.data,type:Ce,media:{media_url:"https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4",autoplay:!1}};break;case be:this.model.data={...this.model.data,type:be,min:3,max:10};break;case ge:this.model.data={...this.model.data,type:ge,min:3,max:10};break;case ve:this.model.data={...this.model.data,type:ve};break;case _e:this.model.data={...this.model.data,type:_e};break;case Ee:this.model.data={...this.model.data,type:Ee};break;case"history":const e=Array(20).fill(0).map(((e,t)=>{const s=t%3==0?"user answer":null;return{...this.model,input:s}}));e.push({...this.model,data:{...this.model.data,type:Ee},input:"322342,https://hpf-happify-marty-dev-user-uploads.happify.com/user_uploads/images/ec81/6ffa/ec816ffaedf0dbafd36e5b337ad6970c9b25d5f7_180.jpeg"}),this.model={...this.model,history:e,data:{...this.model.data,type:ie}};case he:this.model.data={...this.model.data,button_text:"Finish",type:he}}}}class Ae{constructor(e={}){this.appendTo=e.appendTo||"body",this.view=e.view||{},this.render(),this._queryDOMElements()}render(){this.compass=document.createElement("compass-component"),this.compass.classList.add("compass"),this.compass.on(U,this.#Z),document.querySelector(this.appendTo).append(this.compass)}bindUserSubmit=e=>{this.compass.on(q,(t=>{const{text:s,value:i}=t.detail;s&&this.appendUserMessage(s),this.inputComponent.remove(),e(i)}))};appendLoading(){this.compassChatComponent.append(this.loadingComponent)}removeLoading(){this.loadingComponent.remove()}appendUserMessage(e){e&&this._appendMessage(e).classList.add("compass-message--right")}appendAnnaMessage(e,t){const s=this._appendMessage(e);t&&s.classList.add("compass-message__text-error")}renderInput(e){this.inputComponent=e,this.compassInputWrapperComponent.append(e),this.inputComponent.focus()}#Z=e=>{e.stopPropagation(),this.view.on.finish()};_appendMessage(e){const t=document.createElement("compass-message");return t.message=e,this.compassChatComponent.append(t),t}_queryDOMElements(){this.compassInputWrapperComponent=this.compass.querySelector(s),this.compassChatComponent=this.compass.querySelector("compass-chat"),this.loadingComponent=Y.loading(),this.inputComponent={}}}function Le({model:e,appendTo:t="body",store:s={},view:i={}}){return new j(s),new se(new ye({...e}),new Ae({appendTo:t,view:i}))}return t.default})()}));